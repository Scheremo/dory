# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "master" branch
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
stages:
    - build_container
    - dory_test_gap8

build_container:
    stage: build_container
    image: $CI_REGISTRY_IMAGE:latest
    script:
      - docker build -t dory_with_gap_sdk .
    tags:
      - docker

dory_test_gap8:
    stage: dory_test_gap8
    image: $CI_REGISTRY_IMAGE:latest
    script:
      - source sourceme.sh
      - 10
      - cd dory
      - python3 -m pytest
    artifacts:
      paths:
        - dory/application
    tags:
      - dory
